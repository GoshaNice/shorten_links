# Сервис сокращения ссылок (FastAPI)

Данный проект представляет собой учебный API-сервис для сокращения URL-ссылок, разработанный с использованием FastAPI, PostgreSQL и Redis. Сервис позволяет зарегистрированным пользователям создавать короткие ссылки для длинных URL и управлять ими.

## Возможности

- **Создание короткой ссылки** (`POST /links/shorten`): создание сокращенного URL для переданного оригинального адреса. Можно указать желаемый alias (короткий код ссылки) и срок жизни ссылки (`expires_at`).
- **Переход по короткой ссылке** (`GET /links/{short_code}`): редирект пользователя на оригинальный URL по короткому коду. Каждый переход учитывается в статистике.
- **Удаление ссылки** (`DELETE /links/{short_code}`): удаление ранее созданной короткой ссылки.
- **Обновление ссылки** (`PUT /links/{short_code}`): изменение оригинального URL, на который указывает короткая ссылка.
- **Статистика по ссылке** (`GET /links/{short_code}/stats`): получение данных по короткой ссылке (дата создания, количество переходов, дата последнего использования).
- **Поиск ссылки по оригинальному URL** (`GET /links/search?original_url={url}`): поиск сокращенной ссылки по исходному URL.

Дополнительный функционал:
- **Привязка ссылок к пользователям**: зарегистрированные пользователи могут создавать ссылки, привязанные к их учётной записи.
- **Защищенные операции**: изменение, удаление и получение статистики по ссылкам доступны только авторизованным пользователям (владельцам ссылок).


## Установка и запуск

### Запуск с использованием Docker

1. Убедитесь, что Docker и Docker Compose установлены.
2. Склонируйте репозиторий и перейдите в директорию проекта.
3. Настройте переменные окружения как в `environment/docker`
4. Запустите сервисы командой:
   ```bash
   docker-compose up --build

Docker Compose поднимет три контейнера: приложение FastAPI (на порту 9999), базу данных PostgreSQL (порт 5432) и Redis (порт 6379). 
5. После успешного запуска, API будет доступен по адресу http://0.0.0.0:9999. Документация (Swagger UI) будет доступна по адресу http://0.0.0.0:9999/docs


## Тестирование
В репозитории добавлены базовые тесты. Для запуска тестов выполните:
1. Настройте переменные окружения как в `environment/testing`
3. В терминале:
```bash
pip install -r requirements.txt
pytest
```
Информацию по покрытию тестов:
```bash
Name                    Stmts   Miss  Cover
-------------------------------------------
src/auth/__init__.py        0      0   100%
src/auth/db.py             14      2    86%
src/auth/schemas.py         6      0   100%
src/auth/users.py          26      2    92%
src/config.py              10      0   100%
src/database.py             9      0   100%
src/links/__init__.py       0      0   100%
src/links/models.py         4      0   100%
src/links/router.py       116     60    48%
src/links/schemas.py       18      0   100%
src/main.py                29      6    79%
src/models.py              14      0   100%
tests/conftest.py          28      0   100%
tests/test_app.py          53      0   100%
tests/test_unit.py          7      0   100%
-------------------------------------------
TOTAL                     334     70    79%
```
